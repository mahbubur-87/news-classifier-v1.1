(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{268:function(e,t,i){"use strict";i.r(t);i(4),i(5),i(11),i(14),i(7),i(15),i(12),i(13),i(3),i(16),i(8),i(9);var n=i(2),o=i(20),r=(i(43),i(176),i(255));function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(){function e(t,i,n,o,r,s,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&i&&n&&o&&void 0!==r&&s?(this.baseUrl=t,this.site=i,this.userId=n,this.limit=o,this.enableLimitOverlay=r,this.limitOverlayElement=s,this.userFingerprint=c,this.tickTimeoutDuration=3e3,this.tickTimeoutRef=null,this.wardenAllowButton=this.limitOverlayElement.querySelector("#wardenAllowButton"),this.body=document.querySelector("body"),this.baseUrl.endsWith("/")||(this.baseUrl+="/"),this.userFingerprint||(this.userFingerprint=this.getUserFingerprint()),this.initWarden()):console.error("Warden requires baseUrl, site, userId, limit, enableLimitOverlay, limitOverlay for correct instantiation.")}var t,i,n;return t=e,(i=[{key:"getUserFingerprint",value:function(){return localStorage.getItem("wardenFingerprint")?localStorage.getItem("wardenFingerprint"):Object(r.a)()}},{key:"initWarden",value:function(){var e=this;this.wardenAllowButton&&(this.boundHandleClick=function(){return e.handleAllowButtonClick()},this.wardenAllowButton.addEventListener("click",this.boundHandleClick)),localStorage.setItem("wardenFingerprint",this.userFingerprint),this.initPageVisibilityAPI(),this.sendUserTick(),window.addEventListener("unload",(function(){e.signalTabClose()}))}},{key:"initPageVisibilityAPI",value:function(){var e,t=this;this.hiddenPropertyName=void 0,void 0!==document.hidden?(this.hiddenPropertyName="hidden",e="visibilitychange"):void 0!==document.mozHidden?(this.hiddenPropertyName="mozHidden",e="mozvisibilitychange"):void 0!==document.msHidden?(this.hiddenPropertyName="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden?(this.hiddenPropertyName="webkitHidden",e="webkitvisibilitychange"):e="visibilitychange",this.currentVisibilityState=this.visibilityState,this.boundOnVisibilityChange=function(){return t.onVisibilityChange(t.visibilityState)},window.document.addEventListener(e,this.boundOnVisibilityChange),this.boundOnPageHide=function(){return t.onVisibilityChange("hidden")},window.addEventListener("pagehide",this.boundOnPageHide)}},{key:"onVisibilityChange",value:function(e){this.currentVisibilityState!==e&&(this.currentVisibilityState=e,"visible"===e?this.windowForegroundTask():"hidden"===e&&this.windowBackgroundTask())}},{key:"windowBackgroundTask",value:function(){this.tickTimeoutRef&&(clearTimeout(this.tickTimeoutRef),this.tickTimeoutRef=null,this.sendUserDelete())}},{key:"windowForegroundTask",value:function(){this.hideLimitOverlay(),this.tickTimeoutRef||this.sendUserTick()}},{key:"signalTabClose",value:function(){navigator.sendBeacon("".concat(this.baseUrl,"api/v1/remove?site=").concat(encodeURIComponent(this.site),"&user_id=").concat(encodeURIComponent(this.userId),"&fingerprint=").concat(encodeURIComponent(this.userFingerprint),"&limit=").concat(this.limit),null)}},{key:"sendUserTick",value:function(){var e=this;if("visible"===this.visibilityState){var t="".concat(this.baseUrl,"api/v1/tick?site=").concat(encodeURIComponent(this.site),"&user_id=").concat(encodeURIComponent(this.userId),"&fingerprint=").concat(encodeURIComponent(this.userFingerprint),"&limit=").concat(this.limit);fetch(t,{method:"GET"}).then((function(t){403===t.status?e.showLimitOverlay():e.hideLimitOverlay()})).catch((function(e){return console.error("Error while fetching tick:",e)}))}this.tickTimeoutRef=setTimeout((function(){e.sendUserTick()}),this.tickTimeoutDuration)}},{key:"sendUserDelete",value:function(){var e=this,t="".concat(this.baseUrl,"api/v1/remove?site=").concat(encodeURIComponent(this.site),"&user_id=").concat(encodeURIComponent(this.userId),"&fingerprint=").concat(encodeURIComponent(this.userFingerprint),"&limit=").concat(this.limit);fetch(t,{method:"GET"}).then((function(){return e.hideLimitOverlay()})).catch((function(e){return console.error("Error while fetching delete:",e)}))}},{key:"showLimitOverlay",value:function(){this.enableLimitOverlay&&(this.limitOverlayElement.classList.remove("hidden"),this.body.style.overflow="hidden")}},{key:"hideLimitOverlay",value:function(){this.enableLimitOverlay&&(this.limitOverlayElement.classList.add("hidden"),this.body.style.overflow="")}},{key:"handleAllowButtonClick",value:function(){var e=this,t="".concat(this.baseUrl,"api/v1/allow?site=").concat(encodeURIComponent(this.site),"&user_id=").concat(encodeURIComponent(this.userId),"&fingerprint=").concat(encodeURIComponent(this.userFingerprint),"&limit=").concat(this.limit);fetch(t,{method:"GET"}).then((function(){return e.hideLimitOverlay()})).catch((function(e){return console.error("Error while fetching tick:",e)}))}},{key:"destroy",value:function(){var t=this;window.removeEventListener("blur",(function(){return t.boundHandleBlur})),window.removeEventListener("focus",(function(){return t.boundHandleFocus})),this.wardenAllowButton&&this.wardenAllowButton.removeEventListener("click",this.boundHandleClick),c(a(e.prototype),"destroy",this).call(this)}},{key:"visibilityState",get:function(){return this.hiddenPropertyName?window.document[this.hiddenPropertyName]?"hidden":"visible":void 0!==window.document.visibilityState?window.document.visibilityState:void 0}}])&&s(t.prototype,i),n&&s(t,n),e}();function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e,t,i){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.d(t,"default",(function(){return p}));var p=function(e){function t(){var e,i;d(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];(i=f(this,(e=v(t)).call.apply(e,[this].concat(r)))).settings=i.data.settings?JSON.parse(i.data.settings):{};var c=o.a.instance,a=c.hasPaidAccess,u=c.hasNoAdsAccess,h=c.userId,y=c.sessionLimit,m=i.settings.baseUrl||"",p=i.settings.site||"",b=i.settings.enableLimitOverlay||!1,g=i.el;return(a||u)&&h&&y&&(i.warden=new l(m,p,h,y,b,g,"")),i}var i,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,e),i=t,(n=[{key:"destroy",value:function(){y(v(t.prototype),"destroy",this).call(this)}}])&&h(i.prototype,n),r&&h(i,r),t}(n.Component)}}]);